# Prism Code - Claudeé–‹ç™ºã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Prism Codeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“åƒã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€å®Ÿè£…ã®è©³ç´°ã‚’è¨˜è¿°ã—ãŸã‚‚ã®ã§ã™ã€‚Claudeï¼ˆAIï¼‰ãŒã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç†è§£ã—ã€åŠ¹æœçš„ã«é–‹ç™ºæ”¯æ´ã‚’è¡Œã†ãŸã‚ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#1-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#2-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨è¨­è¨ˆæ€æƒ³](#3-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨è¨­è¨ˆæ€æƒ³)
4. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°](#4-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#5-ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
6. [ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè§£èª¬](#6-ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè§£èª¬)
7. [é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](#7-é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼)
8. [æ‹¡å¼µæ–¹æ³•](#8-æ‹¡å¼µæ–¹æ³•)
9. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#9-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
10. [ä»Šå¾Œã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](#10-ä»Šå¾Œã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—)

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 ç›®çš„

Prism Codeã¯ã€**TypeScript/JavaScriptã‚³ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¨ã—ã¦è¦–è¦šåŒ–ã™ã‚‹**VSCodeæ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã‚’ç›´æ„Ÿçš„ã«ç†è§£ã—ã€ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ ã‚’ä¸€ç›®ã§æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚

### 1.2 ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

- **åŒæ–¹å‘æ€§**: ã‚³ãƒ¼ãƒ‰ã¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã®ç›¸äº’å¤‰æ›ï¼ˆå°†æ¥çš„ã«ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆâ†’ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚‚å®Ÿè£…äºˆå®šï¼‰
- **ç–çµåˆè¨­è¨ˆ**: è¨€èªéä¾å­˜ã®IRï¼ˆä¸­é–“è¡¨ç¾ï¼‰ã‚’æ¡ç”¨ã—ã€å°†æ¥çš„ã«è¤‡æ•°è¨€èªã«å¯¾å¿œå¯èƒ½
- **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ€§**: React Flowã«ã‚ˆã‚‹è‡ªç”±ãªã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³æ“ä½œ
- **AIçµ±åˆæº–å‚™**: Phase 3ã§Gemini APIã‚’çµ±åˆã—ã€è‡ªç„¶è¨€èªã‹ã‚‰ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆã‚’å®Ÿç¾äºˆå®š

### 1.3 ä¸»è¦æ©Ÿèƒ½ï¼ˆç¾åœ¨å®Ÿè£…æ¸ˆã¿ï¼‰

- âœ… TypeScript/JavaScriptã‚³ãƒ¼ãƒ‰ã®è§£æï¼ˆts-morphä½¿ç”¨ï¼‰
- âœ… ASTï¼ˆæŠ½è±¡æ§‹æ–‡æœ¨ï¼‰ã®ç”Ÿæˆ
- âœ… IRï¼ˆä¸­é–“è¡¨ç¾ï¼‰ã¸ã®å¤‰æ›
- âœ… React Flowã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º
- âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰ï¼ˆé–‹å§‹/çµ‚äº†/ãƒ—ãƒ­ã‚»ã‚¹/åˆ¤å®š/ãƒ«ãƒ¼ãƒ—ï¼‰
- âœ… Dagreã«ã‚ˆã‚‹è‡ªå‹•ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- âœ… ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å¯è¦–åŒ–

---

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
Prism Code/
â”œâ”€â”€ .vscode/                      # VSCodeè¨­å®š
â”‚   â”œâ”€â”€ launch.json               # ãƒ‡ãƒãƒƒã‚°è¨­å®š
â”‚   â””â”€â”€ tasks.json                # ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯
â”‚
â”œâ”€â”€ src/                          # Extensionå´ï¼ˆNode.jsï¼‰
â”‚   â”œâ”€â”€ core/                     # ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè¨€èªéä¾å­˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ parser/
â”‚   â”‚   â”‚   â”œâ”€â”€ IParser.ts        # ãƒ‘ãƒ¼ã‚µãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆç–çµåˆã®è¦ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ AST.ts            # ASTå‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ ir/
â”‚   â”‚   â”‚   â””â”€â”€ IR.ts             # IRå‹å®šç¾©ï¼ˆä¸­é–“è¡¨ç¾ï¼‰
â”‚   â”‚   â””â”€â”€ transformer/
â”‚   â”‚       â””â”€â”€ IRTransformer.ts  # AST â†’ IR å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚
â”‚   â”œâ”€â”€ parsers/                  # è¨€èªåˆ¥ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ typescript/
â”‚   â”‚   â”‚   â””â”€â”€ TypeScriptParser.ts  # TypeScriptå°‚ç”¨ãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”‚   â””â”€â”€ ParserFactory.ts      # ãƒ‘ãƒ¼ã‚µãƒ¼é¸æŠï¼ˆFactory Patternï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ webview/
â”‚   â”‚   â””â”€â”€ WebViewProvider.ts    # WebViewç®¡ç†ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°
â”‚   â”‚
â”‚   â””â”€â”€ extension.ts              # æ‹¡å¼µæ©Ÿèƒ½ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚
â”œâ”€â”€ webview-ui/                   # WebView UIï¼ˆReact + Viteï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ FlowChart.tsx     # React Flowçµ±åˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â””â”€â”€ nodes/            # ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰
â”‚   â”‚   â”‚       â”œâ”€â”€ StartNode.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ EndNode.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ ProcessNode.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ IfNode.tsx
â”‚   â”‚   â”‚       â””â”€â”€ LoopNode.tsx
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ ir.ts             # IRå‹å®šç¾©ï¼ˆExtensionå´ã¨åŒã˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ flowConverter.ts  # IR â†’ React Flowå¤‰æ›
â”‚   â”‚   â”œâ”€â”€ App.tsx               # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â””â”€â”€ main.tsx              # Reactã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ build/                    # ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ï¼ˆViteï¼‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ out/                          # Extensionå´ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ï¼ˆtscï¼‰
â”œâ”€â”€ sample/                       # ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
â”‚   â””â”€â”€ sample.ts
â”œâ”€â”€ media/
â”‚   â””â”€â”€ icon.svg                  # ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³
â”‚
â”œâ”€â”€ package.json                  # Extensionè¨­å®šãƒ»ä¾å­˜é–¢ä¿‚
â”œâ”€â”€ tsconfig.json                 # TypeScriptè¨­å®šï¼ˆExtensionå´ï¼‰
â”œâ”€â”€ README.md                     # ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ CLAUDE.md                     # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰
â”œâ”€â”€ ä¼ç”»æ›¸.md                     # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¼ç”»æ›¸
â””â”€â”€ å®Ÿéš›ã®å®Ÿè£….md                 # å®Ÿè£…è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

---

## 3. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨è¨­è¨ˆæ€æƒ³

### 3.1 Extensionå´ï¼ˆNode.jsç’°å¢ƒï¼‰

| æŠ€è¡“ | ç”¨é€” | é¸å®šç†ç”± |
|------|------|----------|
| **TypeScript** | å‹å®‰å…¨ãªã‚³ãƒ¼ãƒ‰è¨˜è¿° | å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Š |
| **ts-morph** | TypeScript/JavaScriptãƒ‘ãƒ¼ã‚µãƒ¼ | TypeScript Compiler APIã®ãƒ©ãƒƒãƒ‘ãƒ¼ã€ä½¿ã„ã‚„ã™ã„ |
| **VSCode Extension API** | VSCodeçµ±åˆ | å…¬å¼API |

### 3.2 WebView UIå´ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒï¼‰

| æŠ€è¡“ | ç”¨é€” | é¸å®šç†ç”± |
|------|------|----------|
| **React** | UIæ§‹ç¯‰ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæŒ‡å‘ã€è±Šå¯Œãªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ  |
| **React Flow** | ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæç”» | ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒãƒ¼ãƒ‰ãƒ»ã‚¨ãƒƒã‚¸æ“ä½œãŒå¯èƒ½ |
| **Vite** | ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ« | é«˜é€Ÿãªé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã€æœ€é©åŒ–ã•ã‚ŒãŸãƒ“ãƒ«ãƒ‰ |
| **Dagre** | ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®— | ã‚°ãƒ©ãƒ•ã®è‡ªå‹•é…ç½®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |

### 3.3 è¨­è¨ˆæ€æƒ³

#### 3.3.1 ç–çµåˆè¨­è¨ˆ

**ç›®çš„**: å°†æ¥çš„ã«ä»–è¨€èªï¼ˆJava, Pythonç­‰ï¼‰ã‚’è¿½åŠ ã™ã‚‹éš›ã€æœ€å°é™ã®å¤‰æ›´ã§å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

**å®Ÿç¾æ–¹æ³•**:

- `IParser`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§è¨€èªãƒ‘ãƒ¼ã‚µãƒ¼ã‚’æŠ½è±¡åŒ–
- IRï¼ˆä¸­é–“è¡¨ç¾ï¼‰ã§è¨€èªå›ºæœ‰ã®è©³ç´°ã‚’å¸å
- `ParserFactory`ã§ãƒ‘ãƒ¼ã‚µãƒ¼ã®å‹•çš„é¸æŠ

#### 3.3.2 ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer                  â”‚  â† React WebView UI
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Application Layer                   â”‚  â† VSCode Commands
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Domain Layer                        â”‚  â† IRTransformer, FlowGenerator
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Infrastructure Layer                â”‚  â† TypeScriptParser, WebViewProvider
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã®ã¿ä¾å­˜ã—ã€ä¸‹ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¯ä¾å­˜ã—ãªã„ã€‚

---

## 4. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°

### 4.1 å…¨ä½“ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Action â”‚  â† ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ or ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Extension Host (Node.js)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. visualizeCommand.execute()                    â”‚  â”‚
â”‚  â”‚     â†“                                             â”‚  â”‚
â”‚  â”‚  2. TypeScriptParser.parse(code)                  â”‚  â”‚
â”‚  â”‚     â†“                                             â”‚  â”‚
â”‚  â”‚  3. IRTransformer.transform(ast)                  â”‚  â”‚
â”‚  â”‚     â†“                                             â”‚  â”‚
â”‚  â”‚  4. WebViewProvider.sendFlowData(ir)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ postMessage({ type: 'updateFlow', data: ir })
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WebView (Browser Environment)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. App.tsx: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡                       â”‚  â”‚
â”‚  â”‚     â†“                                             â”‚  â”‚
â”‚  â”‚  2. convertIRToReactFlow(ir)                      â”‚  â”‚
â”‚  â”‚     â†“                                             â”‚  â”‚
â”‚  â”‚  3. Dagreã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—                         â”‚  â”‚
â”‚  â”‚     â†“                                             â”‚  â”‚
â”‚  â”‚  4. FlowChart.tsx: React Flowæç”»                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç–çµåˆã‚’å®Ÿç¾ã™ã‚‹è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

#### 4.2.1 Strategy Patternï¼ˆIParserï¼‰

```typescript
// ãƒ‘ãƒ¼ã‚µãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæŠ½è±¡ï¼‰
interface IParser {
  parse(code: string): AST;
  getSupportedLanguage(): string;
  getSupportedExtensions(): string[];
}

// å…·ä½“å®Ÿè£…ï¼ˆTypeScriptï¼‰
class TypeScriptParser implements IParser { ... }

// å°†æ¥çš„ã«è¿½åŠ å¯èƒ½ï¼ˆJavaï¼‰
class JavaParser implements IParser { ... }
```

#### 4.2.2 Factory Patternï¼ˆParserFactoryï¼‰

```typescript
class ParserFactory {
  static getParser(filePath: string): IParser {
    const ext = path.extname(filePath);
    // æ‹¡å¼µå­ã«å¿œã˜ã¦é©åˆ‡ãªãƒ‘ãƒ¼ã‚µãƒ¼ã‚’è¿”ã™
    // æ–°ã—ã„è¨€èªã‚’è¿½åŠ ã™ã‚‹éš›ã¯ã€ã“ã“ã«ç™»éŒ²ã™ã‚‹ã ã‘
  }
}
```

#### 4.2.3 Observer Patternï¼ˆWebView â†” Extension ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ï¼‰

```typescript
// Extension â†’ WebView
webview.postMessage({ type: 'updateFlow', data: ir });

// WebView â†’ Extension
vscode.postMessage({ type: 'visualize' });
```

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 5.1 ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ â†’ ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆå¤‰æ›

```
TypeScript Source Code
    â†“
[TypeScriptParser]
    â†“ ts-morph APIã§ãƒ‘ãƒ¼ã‚¹
AST (æŠ½è±¡æ§‹æ–‡æœ¨)
    {
      type: 'Program',
      body: [
        { type: 'FunctionDeclaration', name: 'foo', ... },
        { type: 'IfStatement', condition: '...', ... }
      ]
    }
    â†“
[IRTransformer]
    â†“ è¨€èªéä¾å­˜ã®å½¢å¼ã«å¤‰æ›
IR (ä¸­é–“è¡¨ç¾)
    {
      nodes: [
        { id: 'node_0', type: 'start', label: 'é–¢æ•°é–‹å§‹: foo' },
        { id: 'node_1', type: 'if', condition: 'x > 0' },
        ...
      ],
      edges: [
        { id: 'edge_0', source: 'node_0', target: 'node_1' },
        ...
      ]
    }
    â†“
[FlowGenerator]
    â†“ React Flowå½¢å¼ã«å¤‰æ›
React Flow Data
    {
      nodes: [
        { id: 'node_0', type: 'start', position: {x: 100, y: 0}, data: {...} },
        ...
      ],
      edges: [...]
    }
    â†“
[Dagre Layout Algorithm]
    â†“ ãƒãƒ¼ãƒ‰ã®ä½ç½®ã‚’è‡ªå‹•è¨ˆç®—
Positioned React Flow Data
    â†“
[React Flow Component]
    â†“ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
Interactive Flowchart UI
```

### 5.2 IRï¼ˆä¸­é–“è¡¨ç¾ï¼‰ã®è¨­è¨ˆæ„å›³

**ãªãœIRãŒå¿…è¦ã‹ï¼Ÿ**

1. **è¨€èªéä¾å­˜æ€§**: TypeScriptä»¥å¤–ã®è¨€èªã‚’è¿½åŠ ã™ã‚‹éš›ã€IRã®å½¢å¼ã‚’å®ˆã‚Œã°æ—¢å­˜ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å†åˆ©ç”¨ã§ãã‚‹
2. **è¤‡é›‘ã•ã®åˆ†é›¢**: ãƒ‘ãƒ¼ã‚¹å‡¦ç†ã¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Œå…¨ã«åˆ†é›¢
3. **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: IRã®å¦¥å½“æ€§ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆã§ãã‚‹
4. **å°†æ¥ã®æ‹¡å¼µæ€§**: Phase 3ã®åŒæ–¹å‘ç·¨é›†ï¼ˆãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆâ†’ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼‰ã§ã€IRã‚’çµŒç”±ã™ã‚‹ã“ã¨ã§å®Ÿè£…ãŒå®¹æ˜“

---

## 6. ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè§£èª¬

### 6.1 TypeScriptParser

**å½¹å‰²**: TypeScript/JavaScriptã‚³ãƒ¼ãƒ‰ã‚’ASTï¼ˆæŠ½è±¡æ§‹æ–‡æœ¨ï¼‰ã«å¤‰æ›

**å®Ÿè£…ã®è©³ç´°**:

```typescript
class TypeScriptParser implements IParser {
  private project: Project;  // ts-morphã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

  parse(code: string, filePath?: string): AST {
    // 1. ãƒ¡ãƒ¢ãƒªä¸Šã§ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    const sourceFile = this.project.createSourceFile(
      filePath || 'temp.ts',
      code,
      { overwrite: true }
    );

    // 2. ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é–¢æ•°ã€ã‚¯ãƒ©ã‚¹ç­‰ã‚’æŠ½å‡º
    return {
      type: 'Program',
      body: this.parseSourceFile(sourceFile),
      sourceFile: filePath,
    };
  }

  private parseSourceFile(sourceFile: SourceFile): ASTNode[] {
    const nodes: ASTNode[] = [];

    // é–¢æ•°å®£è¨€ã‚’è§£æ
    sourceFile.getFunctions().forEach(fn => {
      nodes.push(this.parseFunctionDeclaration(fn));
    });

    // ã‚¢ãƒ­ãƒ¼é–¢æ•°ã‚’å«ã‚€å¤‰æ•°å®£è¨€ã‚’è§£æ
    sourceFile.getVariableDeclarations().forEach(varDecl => {
      const initializer = varDecl.getInitializer();
      if (Node.isArrowFunction(initializer)) {
        nodes.push(this.parseArrowFunction(varDecl.getName(), initializer));
      }
    });

    return nodes;
  }
}
```

**ã‚µãƒãƒ¼ãƒˆã™ã‚‹æ§‹æ–‡**:

- é–¢æ•°å®£è¨€ï¼ˆ`function foo() {}`ï¼‰
- ã‚¢ãƒ­ãƒ¼é–¢æ•°ï¼ˆ`const foo = () => {}`ï¼‰
- Ifæ–‡ï¼ˆ`if/else`ï¼‰
- ãƒ«ãƒ¼ãƒ—ï¼ˆ`for`, `while`ï¼‰
- å¤‰æ•°å®£è¨€ï¼ˆ`const`, `let`, `var`ï¼‰
- Returnæ–‡

**ä»Šå¾Œè¿½åŠ äºˆå®š**:

- ã‚¯ãƒ©ã‚¹å®šç¾©
- Try-Catch
- Switchæ–‡
- Async/Await

### 6.2 IRTransformer

**å½¹å‰²**: ASTã‚’IRï¼ˆä¸­é–“è¡¨ç¾ï¼‰ã«å¤‰æ›

**å¤‰æ›ãƒ«ãƒ¼ãƒ«**:

| ASTãƒãƒ¼ãƒ‰ | IRãƒãƒ¼ãƒ‰ | å‚™è€ƒ |
|-----------|----------|------|
| FunctionDeclaration | IRStartNode â†’ æœ¬ä½“ â†’ IREndNode | é–¢æ•°ã®é–‹å§‹/çµ‚äº†ã‚’æ˜ç¤º |
| IfStatement | IRControlFlowNode (type: 'if') | then/elseãƒ–ãƒ©ãƒ³ãƒã‚’åˆ†å² |
| ForStatement | IRControlFlowNode (type: 'for') | ãƒ«ãƒ¼ãƒ—ç¶™ç¶šã¨ãƒ«ãƒ¼ãƒ—çµ‚äº†ã®ã‚¨ãƒƒã‚¸ |
| WhileStatement | IRControlFlowNode (type: 'while') | åŒä¸Š |
| VariableDeclaration | IRProcessNode (type: 'variable') | å¤‰æ•°å®£è¨€ãƒãƒ¼ãƒ‰ |
| ReturnStatement | IRProcessNode (type: 'return') | Returnæ–‡ãƒãƒ¼ãƒ‰ |

**é‡è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ**:

```typescript
class IRTransformer {
  private nodeIdCounter = 0;
  private edgeIdCounter = 0;

  // Ifæ–‡ã®å¤‰æ›ä¾‹
  private transformIf(ifNode: IfStatementNode): string {
    const nodeId = this.generateNodeId();
    const mergeId = this.generateNodeId(); // åˆ†å²ã®åˆæµç‚¹

    // Thenåˆ†å²ã®ãƒãƒ¼ãƒ‰ã‚’å¤‰æ›
    const thenIds = ifNode.thenBranch.map(stmt => this.transformNode(stmt));

    // Elseåˆ†å²ã®ãƒãƒ¼ãƒ‰ã‚’å¤‰æ›
    const elseIds = ifNode.elseBranch?.map(stmt => this.transformNode(stmt)) || [];

    // åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ 
    this.nodes.push({
      id: nodeId,
      type: 'if',
      condition: ifNode.condition,
      branches: { then: thenIds, else: elseIds },
      location: ifNode.location,
    });

    // ã‚¨ãƒƒã‚¸ã‚’æ¥ç¶š
    if (thenIds.length > 0) {
      this.addEdge(nodeId, thenIds[0], 'true');  // if â†’ then
      this.addEdge(thenIds[thenIds.length - 1], mergeId);  // then â†’ merge
    }

    if (elseIds.length > 0) {
      this.addEdge(nodeId, elseIds[0], 'false');  // if â†’ else
      this.addEdge(elseIds[elseIds.length - 1], mergeId);  // else â†’ merge
    }

    return nodeId;
  }
}
```

### 6.3 FlowGenerator

**å½¹å‰²**: IRã‚’React Flowå½¢å¼ã«å¤‰æ›

**å¤‰æ›å‡¦ç†**:

1. **ãƒãƒ¼ãƒ‰å¤‰æ›**: IRNode â†’ React Flow Node
   - IDã‚’ãã®ã¾ã¾ä½¿ç”¨
   - typeã‚’React Flowã®ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«ãƒãƒƒãƒ”ãƒ³ã‚°
   - dataã«ãƒãƒ¼ãƒ‰å›ºæœ‰ã®æƒ…å ±ã‚’æ ¼ç´

2. **ã‚¨ãƒƒã‚¸å¤‰æ›**: IREdge â†’ React Flow Edge
   - labelã‚’ä¿æŒï¼ˆ"true", "false", "ãƒ«ãƒ¼ãƒ—"ç­‰ï¼‰
   - typeã‚’`smoothstep`ã«è¨­å®šï¼ˆæ»‘ã‚‰ã‹ãªæ›²ç·šï¼‰
   - animatedãƒ•ãƒ©ã‚°ã§ãƒ«ãƒ¼ãƒ—ã‚¨ãƒƒã‚¸ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

3. **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—**: Dagreã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ãƒãƒ¼ãƒ‰ä½ç½®ã‚’æ±ºå®š
   - Top-to-Bottomï¼ˆTBï¼‰æ–¹å‘
   - ãƒãƒ¼ãƒ‰é–“ã®ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°èª¿æ•´

```typescript
function calculateLayout(nodes: Node[], edges: Edge[]): Node[] {
  const dagreGraph = new dagre.graphlib.Graph();
  dagreGraph.setGraph({
    rankdir: 'TB',  // Top to Bottom
    nodesep: 80,    // ãƒãƒ¼ãƒ‰é–“ã®æ°´å¹³ã‚¹ãƒšãƒ¼ã‚¹
    ranksep: 100,   // ãƒãƒ¼ãƒ‰é–“ã®å‚ç›´ã‚¹ãƒšãƒ¼ã‚¹
  });

  // ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’ç™»éŒ²
  nodes.forEach(node => dagreGraph.setNode(node.id, { width: 200, height: 100 }));
  edges.forEach(edge => dagreGraph.setEdge(edge.source, edge.target));

  // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—
  dagre.layout(dagreGraph);

  // çµæœã‚’é©ç”¨
  return nodes.map(node => {
    const position = dagreGraph.node(node.id);
    return {
      ...node,
      position: { x: position.x - 100, y: position.y - 50 },
    };
  });
}
```

### 6.4 WebViewProvider

**å½¹å‰²**: Extensionã¨WebViewé–“ã®é€šä¿¡ã‚’ç®¡ç†

**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ä»•æ§˜**:

| æ–¹å‘ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹ | ãƒ‡ãƒ¼ã‚¿ | èª¬æ˜ |
|------|-------------|--------|------|
| Extension â†’ WebView | `updateFlow` | `IR` | IRãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¦ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæ›´æ–° |
| WebView â†’ Extension | `visualize` | ãªã— | å¯è¦–åŒ–ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒˆãƒªã‚¬ãƒ¼ |

**å®Ÿè£…**:

```typescript
class WebViewProvider implements vscode.WebviewViewProvider {
  resolveWebviewView(webviewView: vscode.WebviewView): void {
    // WebViewã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡
    webviewView.webview.onDidReceiveMessage((message) => {
      if (message.type === 'visualize') {
        vscode.commands.executeCommand('prismcode.visualize');
      }
    });
  }

  // IRãƒ‡ãƒ¼ã‚¿ã‚’WebViewã«é€ä¿¡
  sendFlowData(ir: IR): void {
    this._view?.webview.postMessage({
      type: 'updateFlow',
      data: ir,
    });
  }
}
```

---

## 7. é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 7.1 åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install
cd webview-ui && pnpm install && cd ..

# 2. ãƒ“ãƒ«ãƒ‰
pnpm run compile          # Extensionå´
pnpm run compile:webview  # WebView UIå´
```

### 7.2 é–‹ç™ºä¸­

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: Extensionå´ã®ç›£è¦–ãƒ¢ãƒ¼ãƒ‰
pnpm run watch

# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: WebView UIã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
cd webview-ui && pnpm run dev
```

### 7.3 ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ

1. VSCodeã§`F5`ã‚­ãƒ¼ã‚’æŠ¼ã™
2. æ–°ã—ã„VSCodeã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ãï¼ˆExtension Development Hostï¼‰
3. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®PrismCodeã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. TypeScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãï¼ˆ`sample/sample.ts`ï¼‰
5. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€ŒğŸ” ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯è¦–åŒ–ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### 7.4 ãƒ“ãƒ«ãƒ‰ï¼ˆæœ¬ç•ªç”¨ï¼‰

```bash
pnpm run vscode:prepublish
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¸¡æ–¹ï¼ˆExtension + WebView UIï¼‰ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã¾ã™ã€‚

### 7.5 ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„

```
<type>: <subject>

<body>
```

**Type**:

- `feat`: æ–°æ©Ÿèƒ½
- `fix`: ãƒã‚°ä¿®æ­£
- `docs`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- `refactor`: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `test`: ãƒ†ã‚¹ãƒˆè¿½åŠ 
- `chore`: ãƒ“ãƒ«ãƒ‰è¨­å®šç­‰

**ä¾‹**:

```
feat: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«å¯è¦–åŒ–ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 

WebViewã‹ã‚‰Extensionã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã€
å¯è¦–åŒ–ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒˆãƒªã‚¬ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã€‚
```

---

## 8. æ‹¡å¼µæ–¹æ³•

### 8.1 æ–°ã—ã„è¨€èªã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã™ã‚‹

**ã‚¹ãƒ†ãƒƒãƒ—1**: ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’å®Ÿè£…

```typescript
// src/parsers/java/JavaParser.ts
export class JavaParser implements IParser {
  parse(code: string): AST {
    // Javaã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã¦ASTã‚’è¿”ã™
    // ä½¿ç”¨å¯èƒ½ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª: java-parser, antlrç­‰
  }

  getSupportedLanguage(): string {
    return 'Java';
  }

  getSupportedExtensions(): string[] {
    return ['.java'];
  }
}
```

**ã‚¹ãƒ†ãƒƒãƒ—2**: ParserFactoryã«ç™»éŒ²

```typescript
// src/parsers/ParserFactory.ts
import { JavaParser } from './java/JavaParser';

export class ParserFactory {
  private static parsers: IParser[] = [
    new TypeScriptParser(),
    new JavaParser(),  // â† è¿½åŠ 
  ];
  // ...
}
```

**ã‚¹ãƒ†ãƒƒãƒ—3**: package.jsonã®activationEventsã‚’æ›´æ–°

```json
"activationEvents": [
  "onLanguage:typescript",
  "onLanguage:java"  // â† è¿½åŠ 
]
```

ã“ã‚Œã ã‘ã§ã€IRTransformerä»¥é™ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯å†åˆ©ç”¨ã§ãã¾ã™ã€‚

### 8.2 æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ ã™ã‚‹

**ã‚¹ãƒ†ãƒƒãƒ—1**: IRå‹å®šç¾©ã‚’æ‹¡å¼µ

```typescript
// src/core/ir/IR.ts
export interface IRTryCatchNode {
  id: string;
  type: 'trycatch';
  tryBody: string[];
  catchBody: string[];
  finallyBody?: string[];
  location: SourceLocation;
}

export type IRNode =
  | IRFunctionNode
  | IRControlFlowNode
  | IRProcessNode
  | IRStartNode
  | IREndNode
  | IRTryCatchNode;  // â† è¿½åŠ 
```

**ã‚¹ãƒ†ãƒƒãƒ—2**: ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰ã‚’ä½œæˆ

```typescript
// webview-ui/src/components/nodes/TryCatchNode.tsx
export function TryCatchNode({ data }: { data: any }) {
  return (
    <div style={{ border: '2px solid orange', ... }}>
      Try-Catch
    </div>
  );
}
```

**ã‚¹ãƒ†ãƒƒãƒ—3**: FlowChartã«ç™»éŒ²

```typescript
// webview-ui/src/components/FlowChart.tsx
import { TryCatchNode } from './nodes/TryCatchNode';

const nodeTypes = {
  start: StartNode,
  end: EndNode,
  process: ProcessNode,
  if: IfNode,
  loop: LoopNode,
  trycatch: TryCatchNode,  // â† è¿½åŠ 
};
```

### 8.3 Phase 2: ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¸ã‚¸ãƒ£ãƒ³ãƒ—

**å®Ÿè£…æ¡ˆ**:

1. IRãƒãƒ¼ãƒ‰ã«`location`æƒ…å ±ï¼ˆè¡Œç•ªå·ï¼‰ã‚’å«ã‚ã‚‹ï¼ˆæ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼‰
2. WebViewã‹ã‚‰Extensionã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡

```typescript
// webview-ui/src/components/FlowChart.tsx
const onNodeClick = (event: React.MouseEvent, node: Node) => {
  vscode.postMessage({
    type: 'jumpToCode',
    data: { location: node.data.location },
  });
};
```

1. Extensionå´ã§è©²å½“è¡Œã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’ç§»å‹•

```typescript
// src/webview/WebViewProvider.ts
webviewView.webview.onDidReceiveMessage((message) => {
  if (message.type === 'jumpToCode') {
    const location = message.data.location;
    // ã‚¨ãƒ‡ã‚£ã‚¿ã®è©²å½“è¡Œã«ã‚¸ãƒ£ãƒ³ãƒ—
    const editor = vscode.window.activeTextEditor;
    const position = new vscode.Position(location.start.line - 1, 0);
    editor.selection = new vscode.Selection(position, position);
    editor.revealRange(new vscode.Range(position, position));
  }
});
```

---

## 9. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 9.1 ã‚ˆãã‚ã‚‹å•é¡Œ

#### å•é¡Œ1: WebViewã«ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„

**åŸå› **:

- WebView UIãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ãªã„
- ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ã®ãƒ‘ã‚¹ãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:

```bash
# WebView UIã‚’å†ãƒ“ãƒ«ãƒ‰
pnpm run compile:webview

# ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ã‚’ç¢ºèª
ls webview-ui/build/assets/
# index.js, index.css ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
```

#### å•é¡Œ2: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼: "File is not under 'rootDir'"

**åŸå› **:

- tsconfig.jsonã®excludeã«webview-uiãŒå«ã¾ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:

```json
// tsconfig.json
{
  "exclude": ["node_modules", ".vscode-test", "sample", "webview-ui"]
}
```

#### å•é¡Œ3: ãƒ‘ãƒ¼ã‚¹å¤±æ•—: "Cannot find name 'ts'"

**åŸå› **:

- ts-morphã®åˆæœŸåŒ–ãŒæ­£ã—ããªã„

**è§£æ±ºæ–¹æ³•**:

```typescript
// TypeScriptParser.ts
this.project = new Project({
  useInMemoryFileSystem: true,
  compilerOptions: {
    target: 99, // Latest
  },
});
```

### 9.2 ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

#### Extensionå´ã®ãƒ­ã‚°ç¢ºèª

```typescript
// src/extension.ts
console.log('Prism Code ãŒèµ·å‹•ã—ã¾ã—ãŸï¼');
console.error('å¯è¦–åŒ–ã‚¨ãƒ©ãƒ¼:', error);
```

**ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•**:

- `Help` â†’ `Toggle Developer Tools` â†’ `Console`ã‚¿ãƒ–

#### WebViewå´ã®ãƒ­ã‚°ç¢ºèª

```typescript
// webview-ui/src/App.tsx
console.log('ãƒ•ãƒ­ãƒ¼å¤‰æ›ã‚¨ãƒ©ãƒ¼:', err);
```

**ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•**:

- WebViewã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ `Inspect Element` â†’ `Console`ã‚¿ãƒ–

---

## 10. ä»Šå¾Œã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 2: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ€§ã®å¼·åŒ–ï¼ˆ3-4é€±é–“ï¼‰

- [ ] ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¸ã‚¸ãƒ£ãƒ³ãƒ—
- [ ] ã‚³ãƒ¼ãƒ‰ç·¨é›†æ™‚ã®è‡ªå‹•æ›´æ–°ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ï¼‰
- [ ] ã‚ˆã‚Šè¤‡é›‘ãªæ§‹æ–‡ã®ã‚µãƒãƒ¼ãƒˆ
  - [ ] ã‚¯ãƒ©ã‚¹å®šç¾©
  - [ ] Try-Catch
  - [ ] Switchæ–‡
  - [ ] Async/Await
- [ ] ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ”¹å–„
  - [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ‰‹å‹•é…ç½®ã®ä¿å­˜
  - [ ] è¤‡æ•°ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆLR, RL, BTç­‰ï¼‰

### Phase 3: åŒæ–¹å‘ç·¨é›†ã¨AIçµ±åˆï¼ˆ2-3ãƒ¶æœˆï¼‰

- [ ] ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç·¨é›†æ©Ÿèƒ½
  - [ ] ãƒãƒ¼ãƒ‰ã®è¿½åŠ ãƒ»å‰Šé™¤
  - [ ] ã‚¨ãƒƒã‚¸ã®æ¥ç¶šå¤‰æ›´
- [ ] ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ â†’ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
  - [ ] IRã‹ã‚‰TypeScriptã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
  - [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ã—ãŸãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ã‚³ãƒ¼ãƒ‰ã«åæ˜ 
- [ ] AIçµ±åˆï¼ˆGemini APIï¼‰
  - [ ] è‡ªç„¶è¨€èªã‹ã‚‰ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆ
  - [ ] ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ç”Ÿæˆ
  - [ ] ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ææ¡ˆ
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
  - [ ] ã‚³ãƒ¼ãƒ‰ç·¨é›†æ™‚ã«ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’è‡ªå‹•æ›´æ–°
  - [ ] ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç·¨é›†æ™‚ã«ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆ

### é•·æœŸçš„ãªç›®æ¨™

- [ ] ä»–è¨€èªå¯¾å¿œ
  - [ ] Java
  - [ ] Python
  - [ ] C#
- [ ] ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
  - [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®è¿½åŠ 
  - [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- [ ] ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
  - [ ] ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®å…±æœ‰
  - [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±åŒç·¨é›†

---

## 11. å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [VSCode Extension API](https://code.visualstudio.com/api)
- [ts-morph Documentation](https://ts-morph.com/)
- [React Flow Documentation](https://reactflow.dev/)
- [Dagre Documentation](https://github.com/dagrejs/dagre)

### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

- [Strategy Pattern](https://refactoring.guru/design-patterns/strategy)
- [Factory Pattern](https://refactoring.guru/design-patterns/factory-method)
- [Observer Pattern](https://refactoring.guru/design-patterns/observer)

### TypeScript AST

- [TypeScript Compiler API](https://github.com/microsoft/TypeScript/wiki/Using-the-Compiler-API)
- [AST Explorer](https://astexplorer.net/) - ASTã®æ§‹é€ ã‚’è¦–è¦šçš„ã«ç¢ºèªã§ãã‚‹ãƒ„ãƒ¼ãƒ«

---

## 12. é‡è¦ãªæ³¨æ„äº‹é …

### 12.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- **å¤§è¦æ¨¡ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†**: ç¾åœ¨ã¯å…¨ä½“ã‚’ä¸€åº¦ã«è§£æã—ã¦ã„ã‚‹ãŸã‚ã€æ•°åƒè¡Œã‚’è¶…ãˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
  - **å°†æ¥ã®æ”¹å–„æ¡ˆ**: é–¢æ•°å˜ä½ã§ã®éƒ¨åˆ†çš„ãªè§£æã€Web Workerã®æ´»ç”¨

### 12.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **WebView**: VSCode WebViewã¯ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚Œã¦ã„ã‚‹ãŒã€Content Security Policyã‚’é©åˆ‡ã«è¨­å®šã—ã¦ã„ã‚‹
  - `script-src 'nonce-{random}'`ã§ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’åˆ¶é™
  - `default-src 'none'`ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’æ‹’å¦

### 12.3 å‹å®‰å…¨æ€§

- **Extensionå´ã¨WebViewå´ã§å‹å®šç¾©ã‚’å…±æœ‰**: `webview-ui/src/types/ir.ts`ã‚’`src/core/ir/IR.ts`ã¨åŒæœŸã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹
  - **å°†æ¥ã®æ”¹å–„æ¡ˆ**: å…±æœ‰å‹å®šç¾©ã‚’åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«åˆ†é›¢

---

## 13. ã¾ã¨ã‚

Prism Codeã¯ã€**ç–çµåˆãªè¨­è¨ˆ**ã¨**ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã«ã‚ˆã‚Šã€å°†æ¥çš„ãªæ‹¡å¼µæ€§ã‚’ç¢ºä¿ã—ã¦ã„ã¾ã™ã€‚ç¾åœ¨ã¯Phase 1ï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰ãŒå®Œæˆã—ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä»Šå¾Œã®Phase 2, 3ã§ã¯ã€ã‚ˆã‚Šé«˜åº¦ãªã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ€§ã¨AIçµ±åˆã‚’å®Ÿç¾ã—ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ã‚„ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ãŸã‚ã®å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã¸ã¨é€²åŒ–ã•ã›ã¦ã„ãã¾ã™ã€‚

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€é–‹ç™ºã‚’é€²ã‚ã‚‹ä¸­ã§ç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã‚‹ã¹ãã‚‚ã®ã§ã™ã€‚æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹éš›ã¯ã€ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚åˆã‚ã›ã¦æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

---

**ä½œæˆæ—¥**: 2026-02-10
**æœ€çµ‚æ›´æ–°**: 2026-02-10
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 0.0.1
